<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enquadramento Estratégico | Terrae Aegis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root {
            --azul-profundo: #0A192F;
            --dourado-fosco: #C5A059;
            --dourado-brilhante: #FFD700;
            --azul-neon: #00FFFF;
            --branco-marfim: #E6E6E6;
            --prata-fosco: #C0C0C0;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--azul-profundo);
            color: var(--branco-marfim);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* BARRA DA TRINDADE */
        .barra-trindade {
            width: 100%;
            display: flex;
            justify-content: center;
            background: rgba(10, 25, 47, 0.95);
            border-bottom: 1px solid rgba(255, 215, 0, 0.3);
            position: fixed;
            top: 0; z-index: 2000;
            backdrop-filter: blur(10px);
        }
        .item-trindade-container { padding: 15px 20px; cursor: pointer; }
        .item-trindade {
            font-size: 0.75em;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: var(--dourado-brilhante);
            font-weight: bold;
        }
        .divisor-trindade { color: var(--dourado-brilhante); padding-top: 13px; opacity: 0.8; }

        .moldura-texto {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 600px;
            padding: 30px;
            border: 1px solid var(--dourado-fosco);
            display: none;
            background: rgba(10, 25, 47, 0.95);
            text-align: center;
            z-index: 3000;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
        }
        .fechar-moldura {
            position: absolute;
            top: 10px;
            right: 15px;
            color: var(--dourado-fosco);
            cursor: pointer;
            font-size: 1.5em;
        }
        #escrita { font-style: italic; line-height: 1.6; color: var(--branco-marfim); font-size: 1.1em; }
        .titulo-moldura {
            color: var(--dourado-fosco);
            text-transform: uppercase;
            letter-spacing: 3px;
            font-size: 1.1em;
            margin-bottom: 15px;
            display: block;
        }

        /* LOADER */
        #loader-seguranca {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--azul-profundo);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 5000; transition: 0.8s;
        }
        .scan-line { width: 200px; height: 2px; background: var(--dourado-fosco); box-shadow: 0 0 15px var(--dourado-fosco); animation: scan 1.5s infinite ease-in-out; }
        @keyframes scan { 0%, 100% { transform: translateY(-20px); } 50% { transform: translateY(20px); } }
        .texto-valida { margin-top: 20px; font-size: 0.7em; letter-spacing: 3px; color: var(--dourado-fosco); text-transform: uppercase; }

        .touro-bg { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60%; opacity: 0.05; z-index: -1; pointer-events: none; }

        /* HUD E PROGRESSO */
        .hud-topo {
            position: fixed; top: 70px; width: 90%; left: 5%;
            display: flex; justify-content: space-between; align-items: center; z-index: 1000;
        }
        .hud-id { font-size: 0.85em; letter-spacing: 1px; color: var(--dourado-fosco); font-style: italic; text-transform: capitalize; }
        .hud-sair { text-decoration: none; color: var(--dourado-fosco); font-size: 0.85em; letter-spacing: 2px; cursor: pointer; transition: 0.3s; }
        .hud-sair:hover { color: var(--azul-neon); }

        .progresso-container {
            position: fixed; top: 52px; left: 0; width: 100%;
            display: flex; gap: 5px; padding: 0 5%; box-sizing: border-box; z-index: 1999;
        }
        .segmento { height: 2px; flex: 1; background: rgba(197, 160, 89, 0.2); transition: 0.6s; }
        .segmento.ativo { background: var(--azul-neon); box-shadow: 0 0 10px var(--azul-neon); }

        /* FORMULÁRIO */
        .wrapper { max-width: 800px; margin: 160px auto 100px; padding: 0 5%; position: relative; }
        .bloco-pergunta { display: none; animation: fadeIn 0.8s ease forwards; }
        .bloco-pergunta.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .titulo-bloco {
            font-size: 1.1em; color: var(--dourado-fosco); text-transform: uppercase;
            letter-spacing: 4px; margin-bottom: 40px; border-bottom: 1px solid rgba(197, 160, 89, 0.1);
            padding-bottom: 10px; text-align: center;
        }

        .campo-grupo { margin-bottom: 30px; position: relative; transition: 0.3s; }
        label { display: block; font-size: 0.75em; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 12px; color: var(--dourado-brilhante); }
        
        input[type="text"], input[type="number"], select, textarea {
            width: 100%; background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(197, 160, 89, 0.2);
            padding: 15px; color: #fff; font-size: 1em; outline: none; box-sizing: border-box;
        }
        textarea { height: 120px; resize: none; font-family: inherit; }
        
        .grid-seletores { display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 10px; margin-top: 10px; }
        .btn-seletor {
            padding: 12px; background: rgba(255,255,255,0.03); border: 1px solid rgba(197, 160, 89, 0.3);
            color: var(--branco-marfim); font-size: 0.8em; text-transform: uppercase; cursor: pointer; transition: 0.3s;
            text-align: center;
        }
        .btn-seletor:hover, .btn-seletor.selected { border-color: var(--azul-neon); background: rgba(0, 255, 255, 0.1); color: #fff; }

        .campo-bloqueado { opacity: 0.15; pointer-events: none; filter: grayscale(1); }
        .campo-bloqueado::after { content: "NÃO REQUERIDO"; position: absolute; top: 40px; right: 0; font-size: 0.6em; color: var(--dourado-fosco); letter-spacing: 2px; }

        /* P17 VERTICAL STYLING */
        .p17-grid { display: grid; gap: 20px; margin-top: 15px; }
        .p17-item { display: flex; align-items: center; justify-content: space-between; background: rgba(255,255,255,0.02); padding: 10px 15px; border-left: 2px solid var(--dourado-fosco); }
        .p17-label { font-size: 0.7em; letter-spacing: 1px; text-transform: uppercase; color: var(--branco-marfim); }
        .p17-niveis { display: flex; gap: 5px; }
        .btn-nivel { width: 35px; height: 35px; border: 0.5px solid rgba(197, 160, 89, 0.5); color: var(--dourado-fosco); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 0.8em; transition: 0.3s; }
        .btn-nivel.selected { background: rgba(0, 255, 255, 0.1); border-color: var(--azul-neon); color: var(--azul-neon); font-weight: bold; box-shadow: 0 0 8px var(--azul-neon); }

        .controles { display: flex; justify-content: space-between; margin-top: 50px; }
        .btn-nav {
            padding: 15px 40px; background: transparent; border: 1px solid var(--dourado-fosco);
            color: var(--dourado-fosco); text-transform: uppercase; letter-spacing: 3px;
            font-weight: bold; cursor: pointer; transition: 0.4s;
        }
        .btn-nav:hover:not(:disabled) { background: var(--dourado-fosco); color: var(--azul-profundo); }
        .btn-nav:disabled { opacity: 0.2; cursor: not-allowed; }

        .assinatura-dev { position: fixed; bottom: 15px; right: 20px; font-size: 0.55em; color: var(--prata-fosco); opacity: 0.6; letter-spacing: 2px; text-transform: uppercase; z-index: 1000; }

        /* CAIXA DE MENSAGEM FINAL */
        #modal-finalizacao {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(10, 25, 47, 0.98);
            display: none; flex-direction: column; align-items: center; justify-content: center;
            z-index: 6000; text-align: center; padding: 20px;
        }
        .msg-box-final { border: 1px solid var(--dourado-fosco); padding: 40px; max-width: 500px; background: rgba(10, 25, 47, 0.9); }
        .msg-box-final p { font-size: 1em; letter-spacing: 2px; color: var(--dourado-fosco); text-transform: uppercase; line-height: 1.6; }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="loader-seguranca">
        <div class="scan-line"></div>
        <div class="texto-valida" id="status-seguranca">Estabelecendo Ambiente Seguro...</div>
    </div>

    <div id="modal-finalizacao">
        <div class="msg-box-final">
            <p>Os dados estão sendo criptografados e enviados para análise. <br><br> Favor aguardar o retorno em até 72 horas.</p>
        </div>
    </div>

    <img src="../logo-touro.png" class="touro-bg">

    <nav class="barra-trindade">
        <div class="item-trindade-container" onclick="escrever('seguranca', 'SEGURANÇA')"><span class="item-trindade">Segurança</span></div>
        <span class="divisor-trindade">|</span>
        <div class="item-trindade-container" onclick="escrever('financas', 'FINANÇAS')"><span class="item-trindade">Finanças</span></div>
        <span class="divisor-trindade">|</span>
        <div class="item-trindade-container" onclick="escrever('governanca', 'GOVERNANÇA')"><span class="item-trindade">Governança</span></div>
    </nav>

    <div id="moldura" class="moldura-texto">
        <span class="fechar-moldura" onclick="fecharMoldura()">×</span>
        <span id="titulo-moldura" class="titulo-moldura"></span>
        <div id="escrita"></div>
    </div>

    <div class="progresso-container">
        <div id="seg-1" class="segmento"></div>
        <div id="seg-2" class="segmento"></div>
        <div id="seg-3" class="segmento"></div>
        <div id="seg-4" class="segmento"></div>
    </div>

    <div class="hud-topo">
        <div class="hud-id" id="hud-nome-display"></div>
        <a href="../index.html" class="hud-sair">Sair</a>
    </div>

    <div class="wrapper">
        <form id="formAegis">
            <div class="bloco-pergunta active" id="bloco-1">
                <div class="titulo-bloco">I. IDENTIFICAÇÃO E ESTRUTURA</div>
                <div class="campo-grupo">
                    <label>1. Titular do Grupo Econômico</label>
                    <input type="text" name="p1" id="p1-field" readonly>
                </div>
                <div class="campo-grupo">
                    <label>2. Razão Social do Grupo Econômico</label>
                    <input type="text" name="p2" id="p2-field">
                </div>
                <div class="campo-grupo">
                    <label>3. Tipo da Empresa (Enquadramento Societário)</label>
                    <div class="grid-seletores">
                        <div class="btn-seletor" onclick="selectBtn(this, 'p3', 'LTDA')">LTDA</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p3', 'S/A Aberta')">S/A Aberta</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p3', 'S/A Fechada')">S/A Fechada</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p3', 'SCP')">SCP</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p3', 'Holding')">Holding</div>
                    </div>
                    <input type="hidden" name="p3" id="input-p3">
                </div>
                <div class="campo-grupo">
                    <label>4. Regime Tributário</label>
                    <div class="grid-seletores">
                        <div class="btn-seletor" onclick="selectBtn(this, 'p4', 'Simples Nacional')">Simples</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p4', 'Lucro Presumido')">Presumido</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p4', 'Lucro Real')">Lucro Real</div>
                    </div>
                    <input type="hidden" name="p4" id="input-p4">
                </div>
                <div class="campo-grupo">
                    <label>5. Percentual de cotas do grupo societário</label>
                    <input type="number" name="p5" id="p5-cotas" placeholder="%" oninput="checkCotas(this.value)">
                    <div id="wrapper-socios" style="display:none; margin-top:15px;">
                        <label style="font-size: 0.6em;">Número de sócios</label>
                        <div class="grid-seletores">
                            <div class="btn-seletor" onclick="selectBtn(this, 'p5_socios', '2')">2</div>
                            <div class="btn-seletor" onclick="selectBtn(this, 'p5_socios', '3-5')">3-5</div>
                            <div class="btn-seletor" onclick="selectBtn(this, 'p5_socios', '5-10')">5-10</div>
                            <div class="btn-seletor" onclick="selectBtn(this, 'p5_socios', '10+')">10+</div>
                        </div>
                        <input type="hidden" name="p5_socios" id="input-p5_socios">
                    </div>
                </div>
            </div>

            <div class="bloco-pergunta" id="bloco-2">
                <div class="titulo-bloco">II. DIMENSIONAMENTO OPERACIONAL</div>
                <div class="campo-grupo">
                    <label>6. Segmento</label>
                    <div class="grid-seletores">
                        <div class="btn-seletor" onclick="selectBtn(this, 'p6', 'Agro')">Agro</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p6', 'Mineração')">Mineração</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p6', 'Indústria')">Indústria</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p6', 'Novos Negócios')">Novos Negócios</div>
                    </div>
                    <input type="hidden" name="p6" id="input-p6">
                </div>
                <div class="campo-grupo">
                    <label>7. Sucessores Diretos</label>
                    <div class="grid-seletores">
                        <div class="btn-seletor" onclick="selectBtn(this, 'p7', '0')">0</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p7', '1 a 5')">1 a 5</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p7', '5 a 10')">5 a 10</div>
                    </div>
                    <input type="hidden" name="p7" id="input-p7">
                </div>
                <div class="campo-grupo">
                    <label>8. Tempo de Existência do Grupo (Anos)</label>
                    <input type="number" name="p8" placeholder="Ex: 15">
                </div>
                <div class="campo-grupo">
                    <label>9. Jurisdição Principal dos Ativos</label>
                    <input type="text" name="p9" placeholder="Ex: BR / SP / São Paulo">
                </div>
                <div class="campo-grupo">
                    <label>10. Canal de Comunicação Principal</label>
                    <div class="grid-seletores">
                        <div class="btn-seletor" onclick="selectBtn(this, 'p10', 'E-mail')">E-mail</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p10', 'WhatsApp')">WhatsApp</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p10', 'Telefone')">Telefone</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p10', 'Outros')">Outros</div>
                    </div>
                    <input type="hidden" name="p10" id="input-p10">
                    <div id="obs-comunicacao" style="display:none; margin-top:10px;">
                        <input type="text" id="p10-obs" placeholder="Especifique (máx 50 caracteres)" maxlength="50">
                    </div>
                </div>
            </div>

            <div class="bloco-pergunta" id="bloco-3">
                <div class="titulo-bloco">III. ANÁLISE DE ATIVOS E RISCOS</div>
                <div class="campo-grupo" id="grupo-p11">
                    <label>11. Média de Extensão Territorial (Hectares)</label>
                    <input type="text" name="p11" id="p11-field">
                </div>
                <div class="campo-grupo" id="grupo-p12">
                    <label>12. Ativos Minerários (ANM / Antigo DNPM)</label>
                    <input type="text" name="p12" id="p12-field">
                </div>
                <div class="campo-grupo">
                    <label>13. Média de Faturamento Bruto Anual Consolidado</label>
                    <div class="grid-seletores">
                        <div class="btn-seletor" onclick="selectBtn(this, 'p13', '0-5M')">0-5M</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p13', '5-15M')">5-15M</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p13', '15-50M')">15-50M</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p13', '50M+')">50M+</div>
                    </div>
                    <input type="hidden" name="p13" id="input-p13">
                </div>
                <div class="campo-grupo">
                    <label>14. Média de Patrimônio Líquido Estimado</label>
                    <input type="text" name="p14" placeholder="Ex: 25.000.000,00">
                </div>
                <div class="campo-grupo">
                    <label>15. Passivo Estrutural / Endividamento (%)</label>
                    <input type="number" name="p15" placeholder="Ex: 30">
                </div>
            </div>

            <div class="bloco-pergunta" id="bloco-4">
                <div class="titulo-bloco">IV. PRIORIDADES ESTRATÉGICAS</div>
                <div class="campo-grupo">
                    <label>16. Maior Necessidade Reconhecida Hoje (Múltipla Escolha)</label>
                    <div class="grid-seletores">
                        <div class="btn-seletor" onclick="toggleMulti(this, 'p16', 'Blindagem')">Blindagem</div>
                        <div class="btn-seletor" onclick="toggleMulti(this, 'p16', 'Finanças')">Finanças</div>
                        <div class="btn-seletor" onclick="toggleMulti(this, 'p16', 'Governança')">Governança</div>
                        <div class="btn-seletor" onclick="toggleMulti(this, 'p16', 'Outros')">Outros</div>
                    </div>
                    <input type="hidden" name="p16" id="input-p16">
                    <div id="obs-p16" style="display:none; margin-top:10px;">
                        <input type="text" id="p16-obs" placeholder="Especifique (máx 50 caracteres)" maxlength="50">
                    </div>
                </div>
                <div class="campo-grupo">
                    <label>17. Prioridade de Resolução (Atribuição de Nível)</label>
                    <div class="p17-grid">
                        <div class="p17-item">
                            <span class="p17-label">Segurança</span>
                            <div class="p17-niveis">
                                <div class="btn-nivel" onclick="selectNivel(this, 'seg', 1)">1</div>
                                <div class="btn-nivel" onclick="selectNivel(this, 'seg', 2)">2</div>
                                <div class="btn-nivel" onclick="selectNivel(this, 'seg', 3)">3</div>
                            </div>
                        </div>
                        <div class="p17-item">
                            <span class="p17-label">Finanças</span>
                            <div class="p17-niveis">
                                <div class="btn-nivel" onclick="selectNivel(this, 'fin', 1)">1</div>
                                <div class="btn-nivel" onclick="selectNivel(this, 'fin', 2)">2</div>
                                <div class="btn-nivel" onclick="selectNivel(this, 'fin', 3)">3</div>
                            </div>
                        </div>
                        <div class="p17-item">
                            <span class="p17-label">Governança</span>
                            <div class="p17-niveis">
                                <div class="btn-nivel" onclick="selectNivel(this, 'gov', 1)">1</div>
                                <div class="btn-nivel" onclick="selectNivel(this, 'gov', 2)">2</div>
                                <div class="btn-nivel" onclick="selectNivel(this, 'gov', 3)">3</div>
                            </div>
                        </div>
                    </div>
                    <div class="btn-seletor" style="margin-top:15px; font-size: 0.7em;" onclick="equivalenciaTotal(this)">Igual Equivalência</div>
                    <input type="hidden" name="p17_data" id="input-p17">
                </div>
                <div class="campo-grupo">
                    <label>18. Deseja adicionar alguma informação adicional?</label>
                    <div class="grid-seletores">
                        <div class="btn-seletor" onclick="toggleInfoAdicional(this, true)">Sim</div>
                        <div class="btn-seletor" onclick="toggleInfoAdicional(this, false)">Não</div>
                    </div>
                    <div id="wrapper-adicional" style="display:none; margin-top:15px;">
                        <textarea name="p18_texto" id="p18-texto" maxlength="3000" placeholder="Espaço para detalhes estratégicos (máx 3.000 caracteres)..."></textarea>
                    </div>
                </div>
                <div class="check-container" style="margin-top:20px; font-size: 0.7em; opacity: 0.8;">
                    <input type="checkbox" id="check-resp">
                    <span>Declaro que as informações são fidedignas.</span>
                </div>
            </div>

            <div class="controles">
                <button type="button" class="btn-nav" id="btn-voltar" onclick="mudarBloco(-1)" disabled>Anterior</button>
                <button type="button" class="btn-nav" id="btn-proximo" onclick="processarAvanco()">Próxima Etapa</button>
            </div>
        </form>
    </div>

    <div class="assinatura-dev">Developed by Terrae Aegis ®</div>

    <script>
        const info = {
            'seguranca': "Sob a égide da invencibilidade, blindamos o patrimônio contra instabilidades globais. Garantimos que a perpetuidade do legado seja a única constante.",
            'financas': "Proporcionamos total independência do sistema nacional para acelerar de forma exponencial seus projetos estratégicos globais.",
            'governanca': "Protocolos internacionais onde o investidor mantém o controle absoluto sobre seus bens, permanecendo sempre à frente dos negócios."
        };

        function escrever(tipo, titulo) {
            const moldura = document.getElementById('moldura');
            const box = document.getElementById('escrita');
            document.getElementById('titulo-moldura').innerText = titulo;
            moldura.style.display = 'block';
            box.innerHTML = "";
            let i = 0; const texto = info[tipo];
            function type() { if (i < texto.length) { box.innerHTML += texto.charAt(i); i++; setTimeout(type, 20); } }
            type();
        }

        function fecharMoldura() { document.getElementById('moldura').style.display = 'none'; }

        // CLICK-OUT GERAL
        document.addEventListener('mousedown', (e) => {
            const moldura = document.getElementById('moldura');
            if (moldura.style.display === 'block' && !moldura.contains(e.target) && !e.target.closest('.item-trindade-container')) {
                fecharMoldura();
            }
        });

        let blocoAtual = 1;

        window.onload = () => {
            const rawName = localStorage.getItem('user_full_name');
            if(rawName) {
                document.getElementById('hud-nome-display').innerHTML = `<i>${rawName}</i>`;
                document.getElementById('p1-field').value = rawName;
            }
            setTimeout(() => { document.getElementById('loader-seguranca').style.display = 'none'; }, 1000);
            atualizarProgresso();
        };

        function checkCotas(val) { document.getElementById('wrapper-socios').style.display = (val && parseInt(val) < 100) ? 'block' : 'none'; }
        
        function toggleInfoAdicional(btn, show) {
            btn.parentElement.querySelectorAll('.btn-seletor').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            document.getElementById('wrapper-adicional').style.display = show ? 'block' : 'none';
        }

        function selectBtn(btn, field, val) {
            btn.parentElement.querySelectorAll('.btn-seletor').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            document.getElementById(`input-${field}`).value = val;

            if(field === 'p6') {
                const gp11 = document.getElementById('grupo-p11');
                const gp12 = document.getElementById('grupo-p12');
                if(val === 'Indústria') {
                    gp11.classList.add('campo-bloqueado');
                    document.getElementById('p11-field').value = "N/A";
                } else gp11.classList.remove('campo-bloqueado');
                
                if(val !== 'Mineração') {
                    gp12.classList.add('campo-bloqueado');
                    document.getElementById('p12-field').value = "N/A";
                } else gp12.classList.remove('campo-bloqueado');
            }
            if(field === 'p10') document.getElementById('obs-comunicacao').style.display = (val === 'Outros' || val === 'Telefone') ? 'block' : 'none';
        }

        let p16Sel = [];
        function toggleMulti(btn, field, val) {
            btn.classList.toggle('selected');
            if(p16Sel.includes(val)) p16Sel = p16Sel.filter(v => v !== val); else p16Sel.push(val);
            document.getElementById(`input-${field}`).value = p16Sel.join(', ');
            if(field === 'p16') document.getElementById('obs-p16').style.display = p16Sel.includes('Outros') ? 'block' : 'none';
        }

        let p17Map = { seg: 0, fin: 0, gov: 0 };
        function selectNivel(btn, pilar, nivel) {
            btn.parentElement.querySelectorAll('.btn-nivel').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            p17Map[pilar] = nivel;
            document.getElementById('input-p17').value = JSON.stringify(p17Map);
            document.querySelector('[onclick="equivalenciaTotal(this)"]').classList.remove('selected');
        }

        function equivalenciaTotal(btn) {
            document.querySelectorAll('.btn-nivel').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            
            // Marcar visualmente o nível 1 em todos
            document.querySelectorAll('.p17-item').forEach(item => {
                item.querySelector('.btn-nivel:nth-child(1)').classList.add('selected');
            });
            
            p17Map = { seg: 1, fin: 1, gov: 1 };
            document.getElementById('input-p17').value = "Equivalência Total (Prioridade 1)";
        }

        function mudarBloco(dir) {
            document.getElementById(`bloco-${blocoAtual}`).classList.remove('active');
            blocoAtual += dir;
            document.getElementById(`bloco-${blocoAtual}`).classList.add('active');
            document.getElementById('btn-voltar').disabled = (blocoAtual === 1);
            document.getElementById('btn-proximo').innerText = (blocoAtual === 4) ? 'Finalizar' : 'Próxima Etapa';
            atualizarProgresso();
            window.scrollTo(0,0);
        }

        function atualizarProgresso() {
            document.querySelectorAll('.segmento').forEach((s, idx) => s.classList.toggle('ativo', idx < blocoAtual));
        }

        function processarAvanco() {
            if(blocoAtual < 4) mudarBloco(1); 
            else {
                if(!document.getElementById('check-resp').checked) {
                    alert("Por favor, declare a fidedignidade das informações.");
                    return;
                }
                
                // Ativar Modal de Criptografia antes de finalizar
                document.getElementById('modal-finalizacao').style.display = 'flex';
                
                setTimeout(() => { 
                    window.location.href = "../index.html"; 
                }, 4000);
            }
        }
    </script>
</body>
</html>
