<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enquadramento Estratégico | Terrae Aegis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root {
            --azul-profundo: #0A192F;
            --dourado-fosco: #C5A059;
            --dourado-brilhante: #FFD700;
            --azul-neon: #00FFFF;
            --branco-marfim: #E6E6E6;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--azul-profundo);
            color: var(--branco-marfim);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* LOADER */
        #loader-seguranca {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--azul-profundo);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 5000; transition: 0.8s;
        }
        .scan-line { width: 200px; height: 2px; background: var(--dourado-fosco); box-shadow: 0 0 15px var(--dourado-fosco); animation: scan 1.5s infinite ease-in-out; }
        @keyframes scan { 0%, 100% { transform: translateY(-20px); } 50% { transform: translateY(20px); } }
        .texto-valida { margin-top: 20px; font-size: 0.7em; letter-spacing: 3px; color: var(--dourado-fosco); text-transform: uppercase; }

        .touro-bg { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60%; opacity: 0.05; z-index: -1; pointer-events: none; }

        .barra-trindade {
            width: 100%; display: flex; justify-content: center;
            background: rgba(10, 25, 47, 0.98); border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            position: fixed; top: 0; z-index: 2000; backdrop-filter: blur(10px);
        }
        .item-trindade { padding: 15px 20px; font-size: 0.7em; letter-spacing: 3px; text-transform: uppercase; color: var(--dourado-brilhante); font-weight: bold; opacity: 0.8; cursor: help; position: relative; }
        
        .tooltip-trindade {
            visibility: hidden; width: 250px; background-color: var(--azul-profundo); color: var(--branco-marfim);
            text-align: center; border: 1px solid var(--dourado-fosco); padding: 10px; position: absolute;
            z-index: 2001; top: 100%; left: 50%; transform: translateX(-50%); font-size: 0.8em;
            text-transform: none; letter-spacing: 0; opacity: 0; transition: 0.3s;
        }
        .item-trindade:hover .tooltip-trindade { visibility: visible; opacity: 1; }

        /* HUD SIMÉTRICO */
        .hud-topo {
            position: fixed; top: 70px; width: 90%; left: 5%;
            display: flex; justify-content: space-between; align-items: center; z-index: 1000;
        }
        .hud-id {
            font-size: 0.85em; letter-spacing: 1px; color: var(--dourado-fosco);
            font-style: italic; text-transform: capitalize;
        }
        .hud-sair {
            text-decoration: none; color: var(--dourado-fosco); font-size: 0.85em;
            letter-spacing: 2px; cursor: pointer; transition: 0.3s;
        }
        .hud-sair:hover { color: var(--azul-neon); }

        .progresso-container {
            position: fixed; top: 52px; left: 0; width: 100%;
            display: flex; gap: 5px; padding: 0 5%; box-sizing: border-box; z-index: 1999;
        }
        .segmento { height: 2px; flex: 1; background: rgba(197, 160, 89, 0.2); transition: 0.6s; }
        .segmento.ativo { background: var(--azul-neon); box-shadow: 0 0 10px var(--azul-neon); }

        .wrapper { max-width: 800px; margin: 160px auto 100px; padding: 0 5%; position: relative; }
        .bloco-pergunta { display: none; animation: fadeIn 0.8s ease forwards; }
        .bloco-pergunta.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .titulo-bloco {
            font-size: 1.1em; color: var(--dourado-fosco); text-transform: uppercase;
            letter-spacing: 4px; margin-bottom: 40px; border-bottom: 1px solid rgba(197, 160, 89, 0.1);
            padding-bottom: 10px; text-align: center;
        }

        .campo-grupo { margin-bottom: 30px; position: relative; transition: 0.3s; }
        label { display: block; font-size: 0.75em; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 12px; color: var(--dourado-brilhante); }
        
        input[type="text"], input[type="number"], select {
            width: 100%; background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(197, 160, 89, 0.2);
            padding: 15px; color: #fff; font-size: 1em; outline: none; box-sizing: border-box;
            transition: 0.3s;
        }
        input:focus, select:focus { border-color: var(--azul-neon); background: rgba(0, 255, 255, 0.05); }

        /* BLOQUEIO E VISUAL */
        .campo-bloqueado { opacity: 0.15; pointer-events: none; filter: grayscale(1); }
        .campo-bloqueado::after { content: "NÃO REQUERIDO"; position: absolute; top: 40px; right: 0; font-size: 0.6em; color: var(--dourado-fosco); letter-spacing: 2px; }

        #p1-field { opacity: 1; pointer-events: none; }

        .grid-seletores { display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 10px; margin-top: 10px; }
        .btn-seletor {
            padding: 12px; background: rgba(255,255,255,0.03); border: 1px solid rgba(197, 160, 89, 0.3);
            color: var(--branco-marfim); font-size: 0.8em; text-transform: uppercase; cursor: pointer; transition: 0.3s;
            text-align: center;
        }
        .btn-seletor:hover, .btn-seletor.selected { border-color: var(--azul-neon); background: rgba(0, 255, 255, 0.1); color: #fff; }

        .controles { display: flex; justify-content: space-between; margin-top: 50px; }
        .btn-nav {
            padding: 15px 40px; background: transparent; border: 1px solid var(--dourado-fosco);
            color: var(--dourado-fosco); text-transform: uppercase; letter-spacing: 3px;
            font-weight: bold; cursor: pointer; transition: 0.4s;
        }
        .btn-nav:hover:not(:disabled) { background: var(--dourado-fosco); color: var(--azul-profundo); }
        .btn-nav:disabled { opacity: 0.2; cursor: not-allowed; }

        .assinatura-dev { position: fixed; bottom: 10px; right: 20px; font-size: 0.5em; color: #C0C0C0; opacity: 0.4; letter-spacing: 2px; }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="loader-seguranca">
        <div class="scan-line"></div>
        <div class="texto-valida" id="status-seguranca">Estabelecendo Ambiente Seguro...</div>
    </div>

    <img src="../logo-touro.png" class="touro-bg">

    <nav class="barra-trindade">
        <div class="item-trindade">Segurança<div class="tooltip-trindade">Sob a égide da invencibilidade, blindamos o patrimônio contra instabilidades globais. Garantimos que a perpetuidade do legado seja a única constante.</div></div>
        <div class="item-trindade">Finanças<div class="tooltip-trindade">Proporcionamos total independência do sistema nacional para acelerar de forma exponencial seus projetos estratégicos globais.</div></div>
        <div class="item-trindade">Governança<div class="tooltip-trindade">Protocolos internacionais onde o investidor mantém o controle absoluto sobre seus bens, permanecendo sempre à frente dos negócios.</div></div>
    </nav>

    <div class="progresso-container">
        <div id="seg-1" class="segmento"></div>
        <div id="seg-2" class="segmento"></div>
        <div id="seg-3" class="segmento"></div>
        <div id="seg-4" class="segmento"></div>
    </div>

    <div class="hud-topo">
        <div class="hud-id" id="hud-nome-display">...</div>
        <a href="../enquadramento/index.html" class="hud-sair">Sair</a>
    </div>

    <div class="wrapper">
        <form id="formAegis">
            <div class="bloco-pergunta active" id="bloco-1">
                <div class="titulo-bloco">I. IDENTIFICAÇÃO</div>
                <div class="campo-grupo">
                    <label>1. Titular do Grupo Econômico</label>
                    <input type="text" name="p1" id="p1-field" readonly>
                </div>
                <div class="campo-grupo">
                    <label>2. Razão Social do Grupo Econômico</label>
                    <input type="text" name="p2" id="p2-field" onblur="mostrarEnquadramento()">
                    <div id="wrapper-enquadramento" style="display:none; margin-top:15px;">
                        <label style="font-size: 0.6em;">Enquadramento Societário</label>
                        <select name="p2_tipo" id="p2-tipo">
                            <option value="">Selecione...</option>
                            <option value="SA_ABERTO">S/A - Capital Aberto</option>
                            <option value="SA_FECHADO">S/A - Capital Fechado</option>
                            <option value="LTDA">Limitada (LTDA)</option>
                            <option value="EIRELI_SLU">EIRELI / SLU</option>
                            <option value="OUTROS">Outros / PF</option>
                        </select>
                    </div>
                </div>

                <div class="campo-grupo">
                    <label>3. Tipo da Empresa</label>
                    <div class="grid-seletores">
                        <div class="btn-seletor" onclick="selectBtn(this, 'p3_tipo', 'Limitada')">Limitada</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p3_tipo', 'Hold de capital aberto')">Hold de capital aberto</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p3_tipo', 'S/A de capital aberto')">S/A de capital aberto</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p3_tipo', 'S/A de capital fechado')">S/A de capital fechado</div>
                    </div>
                    <input type="hidden" name="p3_tipo" id="input-p3_tipo">
                </div>

                <div class="campo-grupo">
                    <label>4. Regime Tributário</label>
                    <div class="grid-seletores">
                        <div class="btn-seletor" onclick="selectBtn(this, 'p4_regime', 'Simples Nacional')">Simples Nacional</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p4_regime', 'Lucro Presumido')">Lucro Presumido</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p4_regime', 'Lucro Real')">Lucro Real</div>
                    </div>
                    <input type="hidden" name="p4_regime" id="input-p4_regime">
                </div>

                <div class="campo-grupo">
                    <label>5. Percentual de cotas do grupo societário</label>
                    <input type="number" name="p5_cotas" id="p5-cotas" placeholder="%" oninput="checkCotasSocios(this.value)">
                    <div id="wrapper-num-socios" style="display:none; margin-top:15px;">
                        <label style="font-size: 0.6em;">Número de sócios</label>
                        <div class="grid-seletores">
                            <div class="btn-seletor" onclick="selectBtn(this, 'p5_num_socios', '2')">2</div>
                            <div class="btn-seletor" onclick="selectBtn(this, 'p5_num_socios', '3 à 5')">3 à 5</div>
                            <div class="btn-seletor" onclick="selectBtn(this, 'p5_num_socios', '5 à 10')">5 à 10</div>
                            <div class="btn-seletor" onclick="selectBtn(this, 'p5_num_socios', '10+')">10+</div>
                        </div>
                        <input type="hidden" name="p5_num_socios" id="input-p5_num_socios">
                    </div>
                </div>

                <div class="campo-grupo">
                    <label>6. Segmento</label>
                    <div class="grid-seletores">
                        <div class="btn-seletor" onclick="selectBtn(this, 'p3', 'Agro')">Agro</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p3', 'Mineração')">Mineração</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p3', 'Indústria')">Indústria</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p3', 'Novos Negócios')">Novos Negócios</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p3', 'Outros')">Outros</div>
                    </div>
                    <input type="hidden" name="p3" id="input-p3">
                </div>
                <div class="campo-grupo">
                    <label>7. Sucessores Diretos</label>
                    <div class="grid-seletores">
                        <div class="btn-seletor" onclick="selectBtn(this, 'p4', '0')">0</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p4', '1 a 5')">1 a 5</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p4', '5 a 10')">5 a 10</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p4', '10+')">10+</div>
                    </div>
                    <input type="hidden" name="p4" id="input-p4">
                </div>
                <div class="campo-grupo">
                    <label>8. Canal de Comunicação Principal</label>
                    <div class="grid-seletores">
                        <div class="btn-seletor" onclick="toggleMulti(this, 'E-mail')">E-mail</div>
                        <div class="btn-seletor" onclick="toggleMulti(this, 'WhatsApp')">WhatsApp</div>
                        <div class="btn-seletor" onclick="toggleMulti(this, 'Outros')">Outros</div>
                    </div>
                    <input type="hidden" name="p5" id="input-p5">
                </div>
            </div>

            <div class="bloco-pergunta" id="bloco-2">
                <div class="titulo-bloco">II. DIMENSIONAMENTO DE ATIVOS</div>
                <div class="campo-grupo">
                    <label>9. Jurisdição Principal dos Ativos</label>
                    <input type="text" name="p6" placeholder="Ex: BR / SP / São Paulo">
                </div>
                <div class="campo-grupo" id="grupo-p7">
                    <label>10. Média de Extensão Territorial (Hectares)</label>
                    <input type="text" name="p7" id="p7-field">
                </div>
                <div class="campo-grupo" id="grupo-p8">
                    <label>11. Ativos Minerários (ANM / Antigo DNPM)</label>
                    <input type="text" name="p8" id="p8-field">
                </div>
                <div class="campo-grupo">
                    <label>12. Média de Faturamento Bruto Anual Consolidado</label>
                    <div class="grid-seletores">
                        <div class="btn-seletor" onclick="selectBtn(this, 'p9', '0-5M')">0-5M</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p9', '5-10M')">5-10M</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p9', '10-15M')">10-15M</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p9', '15-20M')">15-20M</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p9', '20-50M')">20-50M</div>
                        <div class="btn-seletor" onclick="selectBtn(this, 'p9', '50M+')">50M+</div>
                    </div>
                    <input type="hidden" name="p9" id="input-p9">
                </div>
            </div>

            <div class="bloco-pergunta" id="bloco-3">
                <div class="titulo-bloco">III. VULNERABILIDADE E GOVERNANÇA</div>
                <div class="campo-grupo">
                    <label>13. Maior Necessidade Reconhecida Hoje</label>
                    <div class="grid-seletores">
                        <div class="btn-seletor" onclick="toggleMultiNeed(this, 'Blindagem Patrimonial')">Blindagem Patrimonial</div>
                        <div class="btn-seletor" onclick="toggleMultiNeed(this, 'Fluxo Financeiro')">Fluxo Financeiro</div>
                        <div class="btn-seletor" onclick="toggleMultiNeed(this, 'Governança')">Governança</div>
                        <div class="btn-seletor" onclick="toggleMultiNeed(this, 'Outros')">Outros</div>
                    </div>
                    <input type="hidden" name="p13" id="input-p13">
                </div>
                <div class="campo-grupo">
                    <label>14. Prioridade de Resolução</label>
                    <select name="p14" id="p14-prioridade">
                        <option value="">Selecione...</option>
                        <option value="Gov-Fin-Seg">Governança | Finanças | Segurança</option>
                        <option value="Seg-Fin-Gov">Segurança | Finanças | Governança</option>
                        <option value="Equivalencia">Igual equivalência</option>
                    </select>
                </div>
                <div class="check-container" style="margin-top:20px; font-size: 0.7em; opacity: 0.8;">
                    <input type="checkbox" id="check-resp">
                    <span>Declaro que as informações são fidedignas.</span>
                </div>
            </div>

            <div class="controles">
                <button type="button" class="btn-nav" id="btn-voltar" onclick="mudarBloco(-1)" disabled>Anterior</button>
                <button type="button" class="btn-nav" id="btn-proximo" onclick="processarAvanco()">Próxima Etapa</button>
            </div>
        </form>
    </div>

    <script>
        const SCRIPT_URL = 'SUA_URL_AQUI';
        let blocoAtual = 1;
        let canais = [];
        let necessidades = [];

        window.onload = () => {
            const rawName = localStorage.getItem('terrae_user_name') || "Soberano";
            const formattedName = rawName.toLowerCase().split(' ').map(s => s.charAt(0).toUpperCase() + s.substring(1)).join(' ');
            document.getElementById('hud-nome-display').innerHTML = `<i>${formattedName}</i>`;
            document.getElementById('p1-field').value = formattedName;

            setTimeout(() => {
                document.getElementById('loader-seguranca').style.opacity = '0';
                setTimeout(() => { document.getElementById('loader-seguranca').style.display = 'none'; }, 800);
            }, 1000);
            atualizarProgresso();
        };

        function mostrarEnquadramento() { if(document.getElementById('p2-field').value !== "") document.getElementById('wrapper-enquadramento').style.display = 'block'; }
        
        function checkCotasSocios(val) {
            document.getElementById('wrapper-num-socios').style.display = (val && parseInt(val) < 100) ? 'block' : 'none';
        }

        function selectBtn(btn, field, val) {
            btn.parentElement.querySelectorAll('.btn-seletor').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            document.getElementById(`input-${field}`).value = val;

            if(field === 'p3') {
                const gp7 = document.getElementById('grupo-p7');
                const gp8 = document.getElementById('grupo-p8');
                if(val === 'Indústria') {
                    gp7.classList.add('campo-bloqueado');
                    document.getElementById('p7-field').value = "N/A - Não se aplica";
                } else {
                    gp7.classList.remove('campo-bloqueado');
                    if(document.getElementById('p7-field').value === "N/A - Não se aplica") document.getElementById('p7-field').value = "";
                }
                if(val !== 'Mineração') {
                    gp8.classList.add('campo-bloqueado');
                    document.getElementById('p8-field').value = "N/A - Não se aplica";
                } else {
                    gp8.classList.remove('campo-bloqueado');
                    if(document.getElementById('p8-field').value === "N/A - Não se aplica") document.getElementById('p8-field').value = "";
                }
            }
        }

        function toggleMulti(btn, val) {
            btn.classList.toggle('selected');
            canais = canais.includes(val) ? canais.filter(c => c !== val) : [...canais, val];
            document.getElementById('input-p5').value = canais.join(', ');
        }

        function toggleMultiNeed(btn, val) {
            btn.classList.toggle('selected');
            necessidades = necessidades.includes(val) ? necessidades.filter(c => c !== val) : [...necessidades, val];
            document.getElementById('input-p13').value = necessidades.join(', ');
        }

        function mudarBloco(dir) {
            document.getElementById(`bloco-${blocoAtual}`).classList.remove('active');
            blocoAtual += dir;
            document.getElementById(`bloco-${blocoAtual}`).classList.add('active');
            document.getElementById('btn-voltar').disabled = (blocoAtual === 1);
            document.getElementById('btn-proximo').innerText = (blocoAtual === 3) ? 'Finalizar' : 'Próxima Etapa';
            atualizarProgresso();
            window.scrollTo(0,0);
        }

        function atualizarProgresso() {
            document.querySelectorAll('.segmento').forEach((s, idx) => s.classList.toggle('ativo', idx < blocoAtual));
        }

        function processarAvanco() { if(blocoAtual < 3) mudarBloco(1); else finalizar(); }
        function finalizar() { alert('Processando Enquadramento...'); }
    </script>
</body>
</html>
